<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22black%22/><text y=%22.82em%22 x=%2250%%22 font-family=%22monospace%22 font-size=%2290%22 fill=%22white%22 font-weight=%22bold%22 text-anchor=%22middle%22>+</text></svg>">
    <title>FIZYKA_SYSTEM_V7</title>
    <style>
        body { font-family: monospace; font-size: 12px; background: white; color: black; }
        .s { border: 1px solid black; padding: 10px; margin-bottom: 5px; }
        .t { font-size: 40px; font-weight: bold; margin: 5px 0; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 2px; text-align: left; }
        button { background: #eee; border: 1px solid black; cursor: pointer; font-family: monospace; }
        .bar-area { display: flex; align-items: flex-end; height: 40px; border: 1px solid black; margin-top: 5px; }
        .b { background: black; flex: 1; border: 1px solid white; }
    </style>
</head>
<body>

<div class="s">
    <strong>STATYSTYKI_CZASU:</strong><br>
    CZAS_DZISIAJ: <span id="tdt">00:00:00</span> (ZADANIA: <span id="dc">0</span>)<br>
    CZAS_TOTAL_OVERALL: <span id="tot">00:00:00</span><br>
    SREDNI_CZAS_NA_ZADANIE: <span id="avg">0s</span>
</div>

<div class="s">
    <strong>WYKRES_7_DNI:</strong>
    <div class="bar-area" id="ch"></div>
</div>

<div class="s">
    <strong>OPERACJE:</strong><br>
    NAZWA: <input type="text" id="tn" style="border:1px solid black; width:200px;">
    <div class="t" id="disp">00:00:00.000</div>
    <button onclick="tg()">START/STOP</button>
    <button onclick="rs()">RESET</button>
    <button onclick="sv()" style="font-weight:bold;">ZAPISZ_I_NASTEPNE</button>
</div>

<div class="s">
    <strong>LOG_ZADAN:</strong>
    <table id="ht">
        <thead><tr><th>DATA</th><th>NAZWA</th><th>CZAS</th></tr></thead>
        <tbody id="lb"></tbody>
    </table>
</div>

<button onclick="cl()" style="font-size:9px;">WYCZYSC_DATABASE</button>

<script>
    let st, int, el = 0, h = JSON.parse(localStorage.getItem('f_v7')) || [];

    function tg() {
        if (!int) {
            st = Date.now() - el;
            int = setInterval(() => { el = Date.now() - st; up(); }, 10);
        } else { clearInterval(int); int = null; }
    }

    function up() {
        let m = String(el % 1000).padStart(3, '0');
        let s = String(Math.floor(el / 1000) % 60).padStart(2, '0');
        let mn = String(Math.floor(el / 60000) % 60).padStart(2, '0');
        let hr = String(Math.floor(el / 3600000)).padStart(2, '0');
        document.getElementById("disp").innerText = `${hr}:${mn}:${s}.${m}`;
    }

    function rs() { clearInterval(int); int = null; el = 0; up(); }

    function f(ms) {
        let s = Math.floor(ms / 1000);
        let hr = Math.floor(s / 3600);
        let mn = Math.floor((s % 3600) / 60);
        let sc = s % 60;
        return `${String(hr).padStart(2,'0')}:${String(mn).padStart(2,'0')}:${String(sc).padStart(2,'0')}`;
    }

    function sv() {
        if (el === 0) return;
        h.unshift({ d: new Date().toISOString().split('T')[0], n: document.getElementById("tn").value || "ZAD", t: document.getElementById("disp").innerText, ms: el });
        localStorage.setItem('f_v7', JSON.stringify(h));
        document.getElementById("tn").value = "";
        clearInterval(int); el = 0; st = Date.now();
        int = setInterval(() => { el = Date.now() - st; up(); }, 10);
        rn();
    }

    function rn() {
        const today = new Date().toISOString().split('T')[0];
        const t_tasks = h.filter(x => x.d === today);
        const all_ms = h.reduce((a, b) => a + b.ms, 0);
        const day_ms = t_tasks.reduce((a, b) => a + b.ms, 0);

        document.getElementById("lb").innerHTML = h.slice(0, 10).map(x => `<tr><td>${x.d}</td><td>${x.n}</td><td>${x.t}</td></tr>`).join('');
        document.getElementById("dc").innerText = t_tasks.length;
        document.getElementById("tdt").innerText = f(day_ms);
        document.getElementById("tot").innerText = f(all_ms);
        document.getElementById("avg").innerText = h.length ? Math.round((all_ms/h.length)/1000) + "s" : "0s";

        const cts = {}; h.forEach(x => cts[x.d] = (cts[x.d] || 0) + 1);
        const dts = Object.keys(cts).sort().slice(-7);
        const mx = Math.max(...Object.values(cts), 1);
        document.getElementById("ch").innerHTML = dts.map(d => `<div class="b" style="height:${(cts[d]/mx)*100}%"></div>`).join('');
    }

    function cl() { if(confirm("DEL?")) { localStorage.removeItem('f_v7'); h = []; rn(); } }
    rn();
</script>
</body>
</html>
