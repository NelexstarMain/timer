<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>RAW_TRACKER_V5</title>
    <style>
        body { font-family: monospace; background: #fff; color: #000; padding: 20px; line-height: 1.2; }
        .container { border: 2px solid #000; padding: 20px; max-width: 600px; }
        .timer { font-size: 4rem; font-weight: bold; border-bottom: 2px solid #000; margin: 10px 0; padding: 10px 0; }
        input { width: 100%; border: 2px solid #000; padding: 10px; font-family: monospace; font-size: 1rem; margin-bottom: 10px; outline: none; }
        button { background: #000; color: #fff; border: none; padding: 10px 20px; font-family: monospace; font-weight: bold; cursor: pointer; margin-right: 5px; margin-bottom: 5px; }
        button:hover { background: #444; }
        .chart { display: flex; align-items: flex-end; height: 100px; border: 1px solid #000; margin: 20px 0; padding: 10px; }
        .bar-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .bar { width: 80%; background: #000; border: 1px solid #000; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #000; padding: 5px; text-align: left; font-size: 0.8rem; }
        h1, h2, h3 { margin: 0 0 10px 0; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="container">
    <h3>[STATYSTYKI_DNI]</h3>
    <div class="chart" id="chart"></div>

    <h3>[LICZNIK_CZASU]</h3>
    <input type="text" id="taskName" placeholder="NAZWA_ZADANIA" spellcheck="false">
    <div class="timer" id="display">00:00:00.000</div>
    
    <button onclick="toggle()">START/STOP</button>
    <button onclick="reset()">RESET</button>
    <button onclick="save()" style="width: 100%; margin-top: 10px; background: #000; color: #fff;">ZAPISZ_ZADANIE_I_RESETUJ</button>
</div>

<h3>[HISTORIA_LOG]</h3>
<table id="historyTable">
    <thead>
        <tr><th>DATA</th><th>ZADANIE</th><th>CZAS</th></tr>
    </thead>
    <tbody id="logBody"></tbody>
</table>

<button onclick="clearData()" style="background:none; color:#000; border:1px solid #000; margin-top:20px; font-size:0.7rem;">WYCZYSC_WSZYSTKO</button>

<script>
    let start, interval, elapsed = 0, history = JSON.parse(localStorage.getItem('raw_v5')) || [];

    function toggle() {
        if (!interval) {
            start = Date.now() - elapsed;
            interval = setInterval(() => { elapsed = Date.now() - start; update(); }, 10);
        } else { clearInterval(interval); interval = null; }
    }

    function update() {
        let ms = String(elapsed % 1000).padStart(3, '0');
        let s = String(Math.floor(elapsed / 1000) % 60).padStart(2, '0');
        let m = String(Math.floor(elapsed / 60000) % 60).padStart(2, '0');
        let h = String(Math.floor(elapsed / 3600000)).padStart(2, '0');
        document.getElementById("display").innerText = `${h}:${m}:${s}.${ms}`;
    }

    function reset() { clearInterval(interval); interval = null; elapsed = 0; update(); }

    function save() {
        if (elapsed === 0) return;
        const name = document.getElementById("taskName").value || "BRAK_NAZWY";
        history.unshift({
            d: new Date().toISOString().split('T')[0],
            n: name,
            t: document.getElementById("display").innerText
        });
        localStorage.setItem('raw_v5', JSON.stringify(history));
        document.getElementById("taskName").value = "";
        reset();
        render();
    }

    function render() {
        // Tabela
        document.getElementById("logBody").innerHTML = history.slice(0, 10).map(h => 
            `<tr><td>${h.d}</td><td>${h.n}</td><td>${h.t}</td></tr>`).join('');
        
        // Wykres
        const counts = {};
        history.forEach(h => counts[h.d] = (counts[h.d] || 0) + 1);
        const dates = Object.keys(counts).sort().slice(-7);
        const max = Math.max(...Object.values(counts), 1);
        
        document.getElementById("chart").innerHTML = dates.map(d => `
            <div class="bar-wrap">
                <span style="font-size:0.6rem">${counts[d]}</span>
                <div class="bar" style="height:${(counts[d]/max)*100}px"></div>
                <span style="font-size:0.5rem">${d.slice(5)}</span>
            </div>`).join('');
    }

    function clearData() { if(confirm("USUNAC?")) { localStorage.removeItem('raw_v5'); history = []; render(); } }

    render();
</script>
</body>
</html>
