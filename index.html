<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Performance Dashboard</title>
    <style>
        :root {
            --bg: #0d1117;
            --surface: #161b22;
            --accent: #58a6ff;
            --success: #3fb950;
            --border: #30363d;
            --text: #c9d1d9;
        }

        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 20px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }

        /* TIMER & INPUT */
        .timer {
            font-family: monospace;
            font-size: 3.5rem;
            color: var(--accent);
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
        }

        input[type="text"] {
            width: 100%;
            background: var(--bg);
            border: 1px solid var(--border);
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button {
            padding: 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
        }
        .btn-start { background: var(--accent); color: white; }
        .btn-save { background: var(--success); color: white; grid-column: span 2; margin-top: 10px; }

        /* WYKRES */
        .chart-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 150px;
            padding-top: 20px;
            border-bottom: 2px solid var(--border);
            margin-bottom: 10px;
        }
        .bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }
        .bar {
            width: 70%;
            background: var(--success);
            border-radius: 3px 3px 0 0;
            transition: height 0.5s ease-out;
            position: relative;
        }
        .bar:hover { filter: brightness(1.2); }
        .bar-val { font-size: 0.7rem; margin-bottom: 5px; }
        .bar-label { font-size: 0.6rem; color: #8b949e; margin-top: 5px; transform: rotate(-45deg); height: 30px; }

        /* TABELA */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.8rem; }
        th { text-align: left; color: #8b949e; border-bottom: 1px solid var(--border); padding: 8px; }
        td { padding: 8px; border-bottom: 1px solid #21262d; }
    </style>
</head>
<body>

<div class="card">
    <h3 style="margin-top:0">STATYSTYKI TYGODNIOWE</h3>
    <div class="chart-container" id="chart">
        </div>
</div>

<div class="card">
    <input type="text" id="taskName" placeholder="NAZWA ZADANIA (NP. DYNAMIKA ZAD 2)...">
    <div class="timer" id="display">00:00:00.000</div>
    <div class="btn-group">
        <button class="btn-start" id="startBtn" onclick="toggleTimer()">START</button>
        <button style="background:#30363d; color:white" onclick="resetTimer()">RESET</button>
        <button class="btn-save" onclick="saveTask()">SKOŃCZ ZADANIE & ZAPISZ</button>
    </div>
</div>

<div class="card">
    <h3>HISTORIA</h3>
    <table id="historyTable">
        <thead>
            <tr><th>DATA</th><th>ZADANIE</th><th>CZAS</th></tr>
        </thead>
        <tbody id="logBody"></tbody>
    </table>
    <button onclick="clearHistory()" style="background:none; color:red; font-size:0.7rem; margin-top:15px; cursor:pointer">WYCZYŚĆ WSZYSTKO</button>
</div>

<script>
    let startTime;
    let timerInterval;
    let elapsed = 0;
    let history = JSON.parse(localStorage.getItem('phys_v4_data')) || [];

    function toggleTimer() {
        if (!timerInterval) {
            startTime = Date.now() - elapsed;
            timerInterval = setInterval(() => {
                elapsed = Date.now() - startTime;
                updateDisplay();
            }, 10);
            document.getElementById("startBtn").innerText = "PAUZA";
        } else {
            clearInterval(timerInterval);
            timerInterval = null;
            document.getElementById("startBtn").innerText = "WZNÓW";
        }
    }

    function updateDisplay() {
        let ms = String(elapsed % 1000).padStart(3, '0');
        let s = String(Math.floor(elapsed / 1000) % 60).padStart(2, '0');
        let m = String(Math.floor(elapsed / 60000) % 60).padStart(2, '0');
        let h = String(Math.floor(elapsed / 3600000)).padStart(2, '0');
        document.getElementById("display").innerText = `${h}:${m}:${s}.${ms}`;
    }

    function resetTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
        elapsed = 0;
        updateDisplay();
        document.getElementById("startBtn").innerText = "START";
    }

    function saveTask() {
        if (elapsed === 0) return;
        
        const name = document.getElementById("taskName").value || "Zadanie fizyka";
        const now = new Date();
        const entry = {
            date: now.toISOString().split('T')[0], // YYYY-MM-DD
            fullTime: now.toLocaleTimeString(),
            task: name,
            duration: document.getElementById("display").innerText,
            rawMs: elapsed
        };

        history.unshift(entry);
        localStorage.setItem('phys_v4_data', JSON.stringify(history));
        
        document.getElementById("taskName").value = "";
        resetTimer();
        refreshUI();
    }

    function refreshUI() {
        renderTable();
        renderChart();
    }

    function renderTable() {
        const body = document.getElementById("logBody");
        body.innerHTML = history.slice(0, 10).map(h => `
            <tr>
                <td>${h.date}</td>
                <td style="color:var(--accent)">${h.task}</td>
                <td style="font-family:monospace">${h.duration}</td>
            </tr>
        `).join('');
    }

    function renderChart() {
        const chart = document.getElementById("chart");
        const counts = {};
        
        // Liczenie zadań na dzień
        history.forEach(h => {
            counts[h.date] = (counts[h.date] || 0) + 1;
        });

        // Pobranie ostatnich 7 dni
        const dates = Object.keys(counts).sort().slice(-7);
        const maxTasks = Math.max(...Object.values(counts), 5);

        chart.innerHTML = dates.map(d => {
            const count = counts[d];
            const height = (count / maxTasks) * 100;
            return `
                <div class="bar-wrapper">
                    <span class="bar-val">${count}</span>
                    <div class="bar" style="height: ${height}%"></div>
                    <span class="bar-label">${d.slice(5)}</span>
                </div>
            `;
        }).join('');
    }

    function clearHistory() {
        if(confirm("Usunąć wszystkie dane?")) {
            localStorage.removeItem('phys_v4_data');
            history = [];
            refreshUI();
        }
    }

    refreshUI();
</script>

</body>
</html>
